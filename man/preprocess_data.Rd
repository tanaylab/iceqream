% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/preprocess.R
\name{preprocess_data}
\alias{preprocess_data}
\title{Preprocess and normalize ATAC-seq data}
\usage{
preprocess_data(
  project_name,
  files = NULL,
  cell_types = NULL,
  peaks = NULL,
  anchor_cell_type = NULL,
  figures_dir = NULL,
  peaks_size = 500,
  binsize = 20,
  overwrite_tracks = FALSE,
  overwrite_marginal = FALSE,
  window_size = 20000,
  minimal_quantile = 0.1,
  const_threshold = -16,
  const_norm_quant = 1,
  const_scaling_quant = 1,
  const_quantile = 0.9,
  prob1_thresh = NULL,
  add_tss_dist = TRUE,
  tss_intervals = "intervs.global.tss",
  proximal_atac_window_size = 20000
)
}
\arguments{
\item{project_name}{Character string. The prefix used for track names and project identification.}

\item{files}{Optional character vector. Paths to input ATAC-seq signal files, can be in bigWig or tsv format, see \code{misha::gtrack.import} for more details. Required if tracks don't exist.}

\item{cell_types}{Optional character vector. Names of cell types to process. If NULL, derived from track names.}

\item{peaks}{Data frame or file path. Peak intervals with required columns 'chrom', 'start', and 'end'.}

\item{anchor_cell_type}{Optional character. Cell type to use as reference for normalization. If NULL, the mean of all cell types is used.}

\item{figures_dir}{Optional character. Directory path to save normalization plots.}

\item{peaks_size}{Numeric. Size to normalize peaks to in base pairs. Default: 500}

\item{binsize}{Numeric. Bin size for signal track import in base pairs. Default: 20}

\item{overwrite_tracks}{Logical. Whether to overwrite existing individual cell type tracks. Default: FALSE}

\item{overwrite_marginal}{Logical. Whether to overwrite existing marginal track. Default: FALSE}

\item{window_size}{Numeric. Window size for regional normalization in base pairs. Default: 2e4}

\item{minimal_quantile}{Numeric. Minimum quantile for regional normalization. Default: 0.1}

\item{const_threshold}{Numeric. Log2 threshold for identifying constitutive peaks. Default: -16}

\item{const_norm_quant}{Numeric. Quantile for constitutive peak normalization. Default: 1}

\item{const_scaling_quant}{Numeric. Scaling quantile for constitutive normalization. Default: 1}

\item{const_quantile}{Numeric. Quantile for probability normalization threshold. Default: 0.9}

\item{prob1_thresh}{Optional numeric. Threshold for probability=1 in normalization.
If NULL, calculated from const_quantile.}

\item{add_tss_dist}{Logical. Whether to add TSS distance to peaks. Default: TRUE}

\item{tss_intervals}{Character. Name of TSS intervals track. Default: "intervs.global.tss"}

\item{proximal_atac_window_size}{Numeric. Window size for proximal ATAC signal computation. For each peak, a feature of the (punctrured) window signal is computed. Default: 2e4}
}
\value{
A list containing:
\itemize{
\item atac: Raw ATAC signal matrix
\item atac_norm: Region-normalized signal matrix
\item atac_norm_const: Constitutive peak-normalized signal matrix
\item atac_norm_prob: Probability-normalized signal matrix
\item peaks: Data frame of peak information
\item additional_features: Data frame of additional features (dinucleotide distribution and punctured regional ATAC signal)
\item params: List of parameters used for normalization
}
}
\description{
This function processes ATAC-seq data by importing signal tracks, normalizing peaks,
and performing multiple normalization steps including regional normalization,
constitutive peak normalization, and probability-based normalization.
}
\details{
The function performs several normalization steps:
\enumerate{
\item Regional normalization using punctured windows around peaks
\item Identification and normalization of constitutive peaks
\item Conversion to probability scores
}

If visualization is enabled (figures_dir is provided), the function generates
scatter plots showing the effects of each normalization step.
}
\examples{
\dontrun{
# Basic usage with existing tracks
result <- preprocess_data(
    project_name = "my_project",
    peaks = "peaks.bed",
    figures_dir = "figures"
)

# Full preprocessing with new data
result <- preprocess_data(
    project_name = "my_project",
    files = c("celltype1.bw", "celltype2.bw"),
    peaks = "peaks.bed",
    anchor_cell_type = "celltype1",
    figures_dir = "figures",
    overwrite_tracks = TRUE
)
}

}
\seealso{
\code{\link{normalize_regional}}, \code{\link{normalize_const}}, \code{\link{normalize_to_prob}}
}
